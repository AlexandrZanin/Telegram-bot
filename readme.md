<h1>Too_Easy_Travel_Skillbox</h1>

***

Телеграмм бот для поиска отелей

Телеграмм бот использует API hotels.com. https://rapidapi.com/apidojo/api/hotels4/

Достунны 4 основные команды:
- highprice (вывод самых дорогих отелей);
- lowprice (вывод самых дешевых отелей);
- bestdeal (вывод лучших отелей по цене и по расстоянию по центру)
- history (история поисковых запросов)

Чтобы использовать бота необходимо зарегистрироваться на сайте https://rapidapi.com/apidojo/api/hotels4/.
А так же необходимо создать телеграмм бота и получить токен.
Создать в корневой папке проекта файл .env и записать туда BOT_TOKEN и x-rapidapi-key.

Например:

BOT_TOKEN="xxxxxx"

x-rapidapi-key="xxxxx"

<h2>О проекте</h2>
Телеграмм бот использует библиотеку pyTelegramBotAPI.

Все необходимые библиотеки можно найти в requirements.txt

Файл main.py является основным, в нём осуществляется запуск бота.

Бот реализован следующим образом: после выбора одной из поисковых команд 
происходит регистрация пользователя. В файле userclass реализован класс
User, атрибутами которого являются все необходимые параметры поиска. Каждый новый юзер 
записывается в словарь user_dict, ключом которого является id юзера,
а value - user (экземпляр класса User).

Далее по сценарию уточняются все параметры поиска и записываются в экземпляры класса.
После чего происходит запись параметров в базу данных. Затем обращение к API, получение ответа, обработка ответа,
запись найденных отелей в базу данных, вывод результатов.



<h2>highprice</h2>


После ввода команды у пользователя запрашивается:
1. ***Город***, где будет проводиться поиск.
    

<em>Случается, что городов с одинаковым и похожим названием несколько.
Появятся кнопки с вариантами городов.</em>

2. ***Валюта.***
3. ***Даты заезда и выезда.*** 

<em>В проекте использована библиотека telegram_bot_calendar.
Даты ограничены текущим числом и 31.12.2023. Дата выезда может быть
на один день минимум позже даты заезда.</em>
4. ***Количество отелей***, которые необходимо вывести в результате (не больше 10).
5. Необходимость загрузки и вывода ***фотографий*** для каждого отеля (“Да/Нет”)
a. При положительном ответе пользователь также вводит ***количество***
необходимых ***фотографий*** (не больше 10).

В файле rapidapi/highprice.py происходит обращение к API.

url="https://hotels4.p.rapidapi.com/properties/list"

Ключевым параметром в передаваемой querystring является "sortOrder": "PRICE_HIGHEST_FIRST"
Что означает, что найденные API отели отсортированы от самого дорогого по убыванию цены от .



<h2>lowrice</h2>

По сценарию выполнения команды всё аналогично highprice.

В файле rapidapi/lowprice.py происходит обращение к API.

url="https://hotels4.p.rapidapi.com/properties/list"

Ключевым параметром в передаваемой querystring является "sortOrder": "PRICE"
это означает, что найденные API отели отсортированы по возрастанию цены от самого дешёвого.


<h2>bestdeal</h2>

После ввода команды у пользователя запрашивается:
1. ***Город***, где будет проводиться поиск.

2. ***Валюта.***
3. ***Даты заезда и выезда.*** 
4. ***Диапазон цен за ночь в выбранной валюте.***
5. ***Максимальное расстояние до центра в км.***
6. ***Количество отелей***.
7. Необходимость загрузки и вывода ***фотографий*** для каждого отеля (“Да/Нет”).
При положительном ответе пользователь также вводит ***количество***
необходимых ***фотографий***.

В файле rapidapi/bestdeal.py происходит обращение к API.

url="https://hotels4.p.rapidapi.com/properties/list"

Ключевым параметром в передаваемой querystring является "sortOrder": "DISTANCE_FROM_LANDMARK",
                 "landmarkIds": "City center".
Это означает, что найденные API отели отсортированы по расстоянию от центра.
Далее проверяются отели на условие непревышения допустимого расстояния до центра.
Если отелей с данными параметрами нашлось меньше необходимого или не найдётся ни одного подходящего, 
то будет выведено сообщение.

<h2>history</h2>


После ввода команды, выводится 5 последних запросов в формате:

***Время запроса: 2022-03-24 02:12:20***

***Команда: /bestdeal***

***Город: Мюнхен***

***Дата заезда: 2022-04-30***

***Дата выезда: 2022-05-09***

***Диапазон цен: 1000-5000***

***Расстояние до центра: 1,2***
 
или 

***Время запроса: 2022-03-24 00:22:04***

***Команда /highprice***

***Город: Helsinki***

***Дата заезда: 2022-03-31***

***Дата выезда: 2022-04-10***

Под каждым выведенным запросом выводится кнопка "Смотреть найденное",
нажав на которую вы можете ещё раз посмотреть все найденные отели.

База данных реализована с помощью ORM библиотеки peewee.
База данных sqllite
В файле orm.py реализованы два класса class Guest(BaseModel) и
class Hotels_find(BaseModel). Соответственно это две таблицы:
таблица поисковых запросов (Guest) и таблица найденных отелей (Hotels_find).
Аттрибуты класса являются столбцами таблиц. 

Две таблицы связаны между собой через аттрибут owner класса
Hotels_find.

***
Также доступны команды:

- ***help***. После ввода команды выводится список команд.

- ***start***. После ввода команды выводится сообщение:
"Привет ✌️ Жми /help"
- ***stop***. После ввода команды выводится ссобщение <im>"Выполните новый поиск"</im>
и выводится список команд.





 







